# patch.txt — 기능 추가(feat) 로그 전용 (버그픽스/리팩터 제외)
# 작성 규칙:
# 1) 날짜 + 버전(semver)
# 2) 한 줄당 하나의 기능 추가:  - feat(scope): 변경 요약  (설명은 한글)
# 3) scope는 영문 소문자 권장(connector/streams/discord/persistence/strategy 등)
# 4) 실제 반영된 항목만 기록(미래 계획/버그픽스/리팩터 제외)
#
# 템플릿(복붙):
# YYYY-MM-DD vX.Y.Z
# - feat(scope): 한글 요약 …
#
# M2 이후 릴리스 예시 템플릿(참고용):
# 2025-09-03 v0.2.0
# - feat(features): 피처 파이프라인 1차(지표 계산/NaN 처리/퍼센타일 캐시)
# - feat(regime): 레짐 분류기(EMA 스프레드·RV 백분위·히스테리시스)
# - feat(forecast): 예측 앙상블/스코어링(트렌드·MR·크로스 가중)
# - feat(risk): ATR-unit 사이징/상관캡/데일리컷
2025-09-03 v0.1.0
- feat(connector): Binance USDⓈ-M 클라이언트 스텁 추가 — 테스트넷/라이브 토글(REST/WS)
- feat(orch): 최소 오케스트레이터 & 상태버스 — ENV 로더/하트비트/마크프라이스 폴러
- feat(streams): StreamManager — kline/markPrice/user 스트림 구독 및 StateBus 갱신
- feat(discord): 한글 슬래시 명령, 대시보드 자동 갱신, 컨트롤 패널 스켈레톤
- feat(persistence): SQLite 스켈레톤 — WAL, 스키마(trades/positions/pnl_daily/config/events/patches) 및 쓰기 유틸
- feat(strategy): 더미 포캐스트 & 스카웃 드라이런 — 콘솔/DB/디스코드 알림
2025-09-03 v0.2.0
- feat(features): 닫힌 봉 기반 피처 엔진(EMA/ATR/RSI/수익률/RV/퍼센타일) 추가 및 StateBus 연동
- feat(regime): EMA 스프레드·RV 백분위 기반 레짐 분류기(히스테리시스/최소 지속 바) 추가 및 StateBus/알림 연동
- feat(forecast): 레짐별 가중 앙상블(추세/MR/크로스) + 온라인 성과(λ)로 미세 조정, 확률/스코어 산출 및 StateBus/알림 연동
- feat(risk): ATR-unit 사이징, 사이드 상관캡, 데일리컷을 갖춘 리스크 엔진 추가 — ENV/DB 로드 및 버스/알림 연동
2025-09-03 v0.3.0
- feat(exec): 타깃→주문 라우터 추가(쿨다운/허용오차/LOT_STEP·MIN_NOTIONAL/ReduceOnly/드라이런·실주문 토글) 및 핫리로드 연동
- feat(reconcile): 유저스트림 체결 수집→DB 기록, 슬리피지 경고/알림, 타깃-포지션 정체 시 라우터 넛지(쿨다운 해제) 추가
- feat(protect): ε-잔차 리포트(목표-포지션 불일치 보고) 및 부분체결 타임아웃 자동 취소 추가
- feat(open_orders): 미체결 주문 관리자 추가 — 정기 조회 및 정책 취소(드리프트/스테일/데일리컷/초과건수) + StateBus 반영/핫리로드
- feat(guard): 최대 레버(총합/심볼별)·손실 스톱아웃·트레일링 스탑 추가 — 즉시 reduceOnly MARKET 강제평탄/축소, DB/알림/핫리로드 연동
- feat(exec_quality): 롤링 윈도우 실행 품질 리포터 추가 — 슬리피지(bps)·넛지/취소 집계, DB/디스코드/버스 반영 및 설정 핫리로드 경로
- feat(order_ledger): 주문 원장/이벤트 테이블(orders/order_events) 추가 및 제출·체결 업데이트 적재, 윈도우 체결률/TTF·취소율 리포트
- feat(kpi): 전략·리스크·실행 품질 KPI 리포터 추가 — 콘솔/디스코드 한국어 패널, StateBus.monitor.kpi 반영 및 핫리로드

2025-09-03 v0.4.0
- feat(replay): ndjson/CSV 캡처 재생 엔진 추가 — 속도배율/루프 지원, StateBus mark/kline 주입
- feat(backtest): CSV 기반 통합 백테스트 러너 추가 — 더미 예측+RiskEngine→체결 시뮬, trades/equity/pnl CSV 출력 및 CLI
- feat(modes): 데이터/트레이드 듀얼 모드 추가 — DATA_MODE(live|testnet|replay) + TRADE_MODE(dry|testnet|live)
- feat(streams): 공개 데이터와 유저스트림 클라이언트 분리 주입 지원
- feat(app): 하이브리드 결선(live 차트 + testnet 주문) 기본 시나리오 추가

2025-09-03 v0.4.1
- feat(strategy-adapter): 백테스트/리플레이에 실전 ForecastEnsemble 주입 가능하도록 어댑터 계층 추가(STRAT_MODE/CLASS/PARAMS)
- feat(backtest): 러너가 어댑터를 통해 예측을 생성하도록 변경(스냅샷 호환 유지)
- feat(ops): 운영 HTTP 엔드포인트 추가 — /healthz /readyz /metrics /kpi (Prometheus 호환), ENV/DB 설정 및 앱 결선
- feat(ops-deploy): Dockerfile 멀티스테이지/비루트 이미지 및 entrypoint 추가
- feat(ops-deploy): docker-compose 프로파일(dry/testnet/live)로 운영 시나리오 분리
- feat(logging): 로테이션 파일 로그 + 콘솔 로그 설정 모듈 도입(LOG_* ENV)
- feat(ops): 운영 HTTP 엔드포인트 추가 — /healthz /readyz /metrics /kpi (Prometheus 호환), ENV/DB 설정 및 앱 결선 Sentry DSN 제공 시 자동 초기화(선택)

2025-09-03 v0.4.2
- feat(ops): Preflight Doctor — 라이브/테스트넷 핑, DB 쓰기, 듀얼 모드 유효성, /healthz/포트 점검 CLI

2025-09-03 v0.6.1
- feat(ops): Ctrl+C 그레이스풀 종료 — OPS HTTP 서버 shutdown/join 추가
- feat(streams): websocket-client 미설치 시 REST markPrice 폴백(옵션) 지원

2025-09-04 v0.6.3
- feat(discord): slash 패널 호환화(locale_str) — name_localizations 제거
- feat(ops): HTTP 서버 shutdown/server_close/join 보강, 종료 로그 '[OPS_HTTP] stopped' 보장
- feat(env): OPS_HTTP, DISCORD_ENABLED 토글 추가

2025-09-04 v0.6.5
- feat(discord): 슬래시 기본 이름 ASCII(/panel) + 한국어 표시 로컬라이즈, 길드 즉시 싱크
- feat(discord): /panel에 ControlPanelView 부착, /routes /status 제공
- feat(discord): on_app_command_error 안내(/패널 → /panel), close()에서 task 정리

2025-09-04 v0.6.6
- feat(discord): PanelManager — PANEL 채널에 고정 메시지+View 상시 유지(핀/재사용/복구)
- feat(discord): slash /panel ASCII 기반 + ko 로컬라이즈, 길드 즉시 싱크, 에러안내
- feat(analysis): AnalysisPublisher — 실시간 레짐/마크 요약을 ANALYSIS 채널 핀메시지로 60s 갱신
- feat(discord): graceful close — dashboard/analysis/panel task 취소 후 close 보장
- chore(env): 중복키 정리(EXEC_ACTIVE/DB_PATH/DATA_MODE/TRADE_MODE), ANALYSIS_REPORT_SEC 추가

2025-09-04 v0.6.8
- feat(analysis): 분석 리포트에 심볼 자동 보강(marks→keys), 점수/방향 다중 경로 추출
- feat(dashboard): 저장된 메시지 채널 불일치 시 자동 재생성(핀/ID 갱신)
- feat(connector): Binance USDⓈ-M 테스트넷 잔액 폴링 → equity 반영(EQUITY_POLL_SEC)
- feat(env): env_int/env_bool/env_list 적용으로 인라인 주석 허용
- chore(discord): /routes로 라우팅 점검(기 설치 확인)

2025-09-04 v0.6.9
- feat(pipeline): kline→features→regime→intent 체인 결선
- feat(analysis): 실시간 점수/방향 렌더러 고정 및 주기 태스크 정리
- feat(ops): Equity 동기화 — USER_STREAM 우선, REST 폴백(EQUITY_POLL_SEC)

2025-09-04 v0.3.6
- feat(panel): 패널 ON/OFF → StateBus·DB upsert 결선(EXEC_ACTIVE)
- feat(exec): 라우팅 앞단 실행 가드(패널/ENV 연동)
- feat(discord): 백그라운드 태스크 레지스트리 및 정상 취소(close 훅)

2025-09-04 v0.3.7
- feat(streams): WS 종료 병렬화 및 타임아웃(WS_STOP_TIMEOUT_S, WS_STOP_MAX_WORKERS)
- feat(dashboard): 대시보드 고정(핀) 자동 복구 — DB(config.DASHBOARD_MSG_ID) 연동

2025-09-05 v0.3.8
- feat(orch): Equity 소스 우선순위 확정(계정→OVERRIDE→기본값)
- fix(panel): 라우터 내부속성 접근 제거(토글 예외 방지)
- chore(req): httpx/requests 명시 추가

2025-09-05 v0.3.9
- feat(app): 강제 .env 로드 및 부팅 요약 로그
- feat(connector): HTTP 드라이버 실행 시점 바인딩(ensure_http)
- feat(orch): TRADE_MODE별 API 키 선택 및 계정 초기화 로그


2025-09-08 v0.6.1
- feat(analysis): TF별 점수/확률/레짐/기여도·지표 포함한 실시간 분석 리포트 고도화
- feat(orch): 포지션 폴링 루프 추가(POSITIONS_POLL_SEC) — UserStream 없이도 포지션 갱신
- feat(exec-toggle): 컨트롤패널 ON 시 BinanceClient.order_active 동기화(의도만 → 실주문)
- feat(kpi): 대시보드에 포지션 상세 테이블 추가 및 레버리지 표기 개선

2025-09-08 v0.6.2
- feat(connector): Futures ACCOUNT 기반 Equity/Available 산출 (/fapi/v2/account)
- feat(orch): 의도 더미(DUMMY_INTENT) 기본 OFF, 패널 ON 시 실주문 라우팅 고정

- feat(analysis): 한글 리포트 — EMA/RV20/ATR/RET1/레짐·기여도 출력
- feat(kpi): 대시보드 ‘사용가능’ 잔고 추가, 포지션 상세 표기 개선
- feat(loops): Equity/Positions 폴링 중복 방지 가드

 
2025-09-08 v0.6.2
- feat(kpi): 당일손익 실시간 계산(DAY_E0 KST 기준) + config 보존
- feat(kpi): 익스포저 '실제/타깃' 분리 표기 및 폴백
- feat(cfg): TF_SIGNAL 기본 1m 포함으로 초기 예측 가속

2025-09-08 v0.6.1
- feat(exec): 주문 프리플라이트(거래소 필터/stepSize/NOTIONAL) + per_sym 레버리지 캡 수량 반영
- feat(exec): -4005 백오프(심볼별 쿨다운) 및 프리플라이트 진단 로그
- feat(connector): exchangeInfo 필터 캐시(warmup)

2025-09-08 v0.6.3
- feat(analysis-report): 실시간 분석 리포트 v2 — 점수 기여/게이트/레디니스/플랜/TF합의/trace 출력
- feat(ticket): 티켓 스키마 및 합의도 계산, trace_id 생성
- feat(statebus): 분석 스냅샷 퍼블리시 헬퍼 추가
- feat(env): OPEN_TH/PUP_TH/REGIME_ALLOW/RV_PCTL_BAND/TF_ORDER/TF_VOTE_WEIGHTS/RISK_R_TARGET/SL_ATR/TP_LADDER

2025-09-08 v0.6.4
- feat(analysis-report): 퍼블리셔 렌더 v2 연결 — 점수/게이트/레디니스/플랜/TF합의/trace 출력
- fix(orch): on_bar_close에서 미존재 API(exec_router.route) 호출 제거 → 리스크 루프 일원화
- fix(kpi): ZoneInfo 미탐색 시 UTC 폴백(DAY_PNL_TZ) — Windows/tzdata 미설치 환경 호환

2025-09-08 v0.6.5
- fix(analysis): 레짐 dict 대응(_norm_regime)으로 .lower() 예외 제거
- fix(ui): 컨트롤패널 자동매매 토글 시 bus.config(dict) 호환 및 router 활성화 동기화
- feat(log): FEATURES/REGIME 로그 샘플링 모드(all|sample|off) + 요약 출력

